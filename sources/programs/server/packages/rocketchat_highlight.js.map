{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat_highlight/highlight.coffee"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;;;GAAA;AAAA;EAAA;;AAAA;AAOc,qBAAC,OAAD;AAEZ;AAAA,QAAG,CAAC,CAAC,IAAF,CAAO,OAAO,CAAC,IAAf,CAAH;;QACC,OAAO,CAAC,SAAU;OAAlB;AAAA,MAGA,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,KAAb,CAAmB,MAAnB,KAA8B,EAA/B,CAAkC,CAAC,MAH3C;AAKA,UAAG,KAAH;AAGC,YAAI,QAAQ,CAAR,GAAY,CAAhB;AACC,iBAAO,CAAC,IAAR,GAAe,OAAO,CAAC,IAAR,GAAe,OAA9B;AAAA,UACA,OAAO,CAAC,GAAR,GAAc,OAAO,CAAC,GAAR,GAAc,OAD5B,CADD;SAAA;AAAA,QAKA,WAAW,OAAO,CAAC,IAAI,CAAC,KAAb,CAAmB,8BAAnB,CALX;AAOA;iCAAA;AAEC,sBAAY,IAAI,CAAC,KAAL,CAAW,gCAAX,CAAZ;AACA,cAAG,iBAAH;AAEC,yBAAa,SAAU,GAAE,CAAC,OAAb,CAAqB,IAArB,MAA8B,EAA3C;AAEA,gBAAG,UAAH;AACC,qBAAO,EAAP;AAAA,cACA,OAAO,CAAC,CAAC,YAAF,CAAe,SAAU,GAAV,GAAe,GAAf,GAAqB,SAAU,GAA9C,CADP,CADD;aAAA;AAIC,qBAAO,SAAU,GAAjB;AAAA,cACA,OAAO,CAAC,CAAC,YAAF,CAAe,SAAU,GAAzB,CADP,CAJD;aAFA;AASA,gBAAG,aAAY,IAAI,CAAC,aAAL,EAAZ,WAAH;AACC,uBAAS,IAAI,CAAC,aAAL,CAAmB,IAAnB,CAAT,CADD;aAAA;AAGC,uBAAS,IAAI,CAAC,SAAL,CAAe,IAAf,EAAqB,IAArB,CAAT,CAHD;aATA;AAAA,YAcA,QAAQ,MAAG,CAAC,MAAM,CAAC,EAAP,EAAD,CAAH,GAAgB,GAdxB;AAAA,YAgBA,OAAO,CAAC,MAAM,CAAC,IAAf,CACC;AAAA,yBAAW,IAAX;AAAA,cACA,OAAO,KADP;AAAA,cAEA,MAAM,4BAA4B,MAAM,CAAC,QAAnC,GAA8C,yCAA9C,GAA0F,MAAM,CAAC,KAAjG,GAAyG,oDAF/G;aADD,CAhBA;AAAA,YAqBA,QAAS,OAAT,GAAkB,KArBlB,CAFD;WAAA;AAyBC,oBAAS,OAAT,GAAkB,IAAlB,CAzBD;WAHD;AAAA,SAPA;AAAA,QAsCA,OAAO,CAAC,IAAR,GAAe,QAAQ,CAAC,IAAT,CAAc,EAAd,CAtCf,CAHD;OAND;KAAA;AAiDA,WAAO,OAAP,CAnDY;EAAA,CAAb;;mBAAA;;IAPD;;AAAA,UA4DU,CAAC,SAAS,CAAC,GAArB,CAAyB,eAAzB,EAA0C,SAA1C,EAAqD,UAAU,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAnF,CA5DA;;AAAA,UA6DU,CAAC,SAAX,GAAuB,IA7DvB","file":"/packages/rocketchat_highlight.js","sourcesContent":["###\n# Highlight is a named function that will highlight ``` messages\n# @param {Object} message - The message object\n###\n\nclass Highlight\n\n\tconstructor: (message) ->\n\n\t\tif s.trim message.html\n\t\t\tmessage.tokens ?= []\n\n\t\t\t# Count occurencies of ```\n\t\t\tcount = (message.html.match(/```/g) || []).length\n\n\t\t\tif count\n\n\t\t\t\t# Check if we need to add a final ```\n\t\t\t\tif (count % 2 > 0)\n\t\t\t\t\tmessage.html = message.html + \"\\n```\"\n\t\t\t\t\tmessage.msg = message.msg + \"\\n```\"\n\n\t\t\t\t# Separate text in code blocks and non code blocks\n\t\t\t\tmsgParts = message.html.split(/(```\\w*[\\n\\ ]?[\\s\\S]*?```+?)/)\n\n\t\t\t\tfor part, index in msgParts\n\t\t\t\t\t# Verify if this part is code\n\t\t\t\t\tcodeMatch = part.match(/```(\\w*)[\\n\\ ]?([\\s\\S]*?)```+?/)\n\t\t\t\t\tif codeMatch?\n\t\t\t\t\t\t# Process highlight if this part is code\n\t\t\t\t\t\tsingleLine = codeMatch[0].indexOf('\\n') is -1\n\n\t\t\t\t\t\tif singleLine\n\t\t\t\t\t\t\tlang = ''\n\t\t\t\t\t\t\tcode = _.unescapeHTML codeMatch[1] + ' ' + codeMatch[2]\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tlang = codeMatch[1]\n\t\t\t\t\t\t\tcode = _.unescapeHTML codeMatch[2]\n\n\t\t\t\t\t\tif lang not in hljs.listLanguages()\n\t\t\t\t\t\t\tresult = hljs.highlightAuto code\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tresult = hljs.highlight lang, code\n\n\t\t\t\t\t\ttoken = \"$#{Random.id()}$\"\n\n\t\t\t\t\t\tmessage.tokens.push\n\t\t\t\t\t\t\thighlight: true\n\t\t\t\t\t\t\ttoken: token\n\t\t\t\t\t\t\ttext: \"<pre><code class='hljs \" + result.language + \"'><span class='copyonly'>```<br></span>\" + result.value + \"<span class='copyonly'><br>```</span></code></pre>\"\n\n\t\t\t\t\t\tmsgParts[index] = token\n\t\t\t\t\telse\n\t\t\t\t\t\tmsgParts[index] = part\n\n\t\t\t\t# Re-mount message\n\t\t\t\tmessage.html = msgParts.join('')\n\n\t\treturn message\n\nRocketChat.callbacks.add 'renderMessage', Highlight, RocketChat.callbacks.priority.HIGH\nRocketChat.Highlight = true\n"]}