{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat_oauth2-server-config/server/models/OAuthApps.coffee","meteor://ðŸ’»app/packages/rocketchat_oauth2-server-config/oauth/server/oauth2-server.coffee","meteor://ðŸ’»app/packages/rocketchat_oauth2-server-config/oauth/server/default-services.coffee","meteor://ðŸ’»app/packages/rocketchat_oauth2-server-config/oauth/client/stylesheets/load.coffee","meteor://ðŸ’»app/packages/rocketchat_oauth2-server-config/admin/server/publications/oauthApps.coffee","meteor://ðŸ’»app/packages/rocketchat_oauth2-server-config/admin/server/methods/addOAuthApp.coffee","meteor://ðŸ’»app/packages/rocketchat_oauth2-server-config/admin/server/methods/updateOAuthApp.coffee","meteor://ðŸ’»app/packages/rocketchat_oauth2-server-config/admin/server/methods/deleteOAuthApp.coffee"],"names":[],"mappings":"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","file":"/packages/rocketchat_oauth2-server-config.js","sourcesContent":["RocketChat.models.OAuthApps = new class extends RocketChat.models._Base\n\tconstructor: ->\n\t\t@_initModel 'oauth_apps'\n\n\n\t# FIND\n\t# findByRole: (role, options) ->\n\t# \tquery =\n\t# \t\troles: role\n\n\t# \treturn @find query, options\n\n\t# CREATE\n","oauth2server = new OAuth2Server\n\taccessTokensCollectionName: 'rocketchat_oauth_access_tokens'\n\trefreshTokensCollectionName: 'rocketchat_oauth_refresh_tokens'\n\tauthCodesCollectionName: 'rocketchat_oauth_auth_codes'\n\tclientsCollection: RocketChat.models.OAuthApps.model\n\tdebug: true\n\n\nWebApp.connectHandlers.use oauth2server.app\n\n\nMeteor.publish 'oauthClient', (clientId) ->\n\tunless @userId\n\t\treturn @ready()\n\n\treturn RocketChat.models.OAuthApps.find {clientId: clientId, active: true},\n\t\tfields:\n\t\t\tname: 1\n\n\nRocketChat.API.v1.addAuthMethod ->\n\tconsole.log @request.method, @request.url\n\n\theaderToken = @request.headers['authorization']\n\tgetToken = @request.query.access_token\n\n\tif headerToken?\n\t\tif matches = headerToken.match(/Bearer\\s(\\S+)/)\n\t\t\theaderToken = matches[1]\n\t\telse\n\t\t\theaderToken = undefined\n\n\tbearerToken = headerToken or getToken\n\n\tif not bearerToken?\n\t\t# console.log 'token not found'.red\n\t\treturn\n\n\t# console.log 'bearerToken', bearerToken\n\n\tgetAccessToken = Meteor.wrapAsync oauth2server.oauth.model.getAccessToken, oauth2server.oauth.model\n\taccessToken = getAccessToken bearerToken\n\n\tif not accessToken?\n\t\t# console.log 'accessToken not found'.red\n\t\treturn\n\n\tif accessToken.expires? and accessToken.expires isnt 0 and accessToken.expires < new Date()\n\t\t# console.log 'accessToken expired'.red\n\t\treturn\n\n\tuser = RocketChat.models.Users.findOne(accessToken.userId)\n\tif not user?\n\t\t# console.log 'user not found'.red\n\t\treturn\n\n\treturn user: user\n\n","if not RocketChat.models.OAuthApps.findOne('zapier')\n\tRocketChat.models.OAuthApps.insert\n\t\t_id: 'zapier'\n\t\tname: 'Zapier'\n\t\tactive: false\n\t\tclientId: 'zapier'\n\t\tclientSecret: 'RTK6TlndaCIolhQhZ7_KHIGOKj41RnlaOq_o-7JKwLr'\n\t\tredirectUri: 'https://zapier.com/dashboard/auth/oauth/return/AppIDAPI/'\n\t\t_createdAt: new Date\n\t\t_createdBy:\n\t\t\t_id: 'system'\n\t\t\tusername: 'system'\n","RocketChat.theme.addPackageAsset ->\n\treturn Assets.getText 'oauth/client/stylesheets/oauth2.less'\n","Meteor.publish 'oauthApps', ->\n\tunless @userId\n\t\treturn @ready()\n\n\tif not RocketChat.authz.hasPermission @userId, 'manage-oauth-apps'\n\t\tthrow new Meteor.Error \"not-authorized\"\n\n\treturn RocketChat.models.OAuthApps.find()\n","Meteor.methods\n\taddOAuthApp: (application) ->\n\t\tif not RocketChat.authz.hasPermission @userId, 'manage-oauth-apps'\n\t\t\tthrow new Meteor.Error 'not_authorized'\n\n\t\tif not _.isString(application.name)\n\t\t\tthrow new Meteor.Error 'invalid_name', '[methods] addOAuthApp -> name must be string'\n\n\t\tif application.name.trim() is ''\n\t\t\tthrow new Meteor.Error 'invalid_name', '[methods] addOAuthApp -> name can\\'t be empty'\n\n\t\tif not _.isString(application.redirectUri)\n\t\t\tthrow new Meteor.Error 'invalid_redirectUri', '[methods] addOAuthApp -> redirectUri must be string'\n\n\t\tif application.redirectUri.trim() is ''\n\t\t\tthrow new Meteor.Error 'invalid_redirectUri', '[methods] addOAuthApp -> redirectUri can\\'t be empty'\n\n\t\tif not _.isBoolean(application.active)\n\t\t\tthrow new Meteor.Error 'invalid_active', '[methods] addOAuthApp -> active must be boolean'\n\n\t\tapplication.clientId = Random.id()\n\t\tapplication.clientSecret = Random.secret()\n\t\tapplication._createdAt = new Date\n\t\tapplication._createdBy = RocketChat.models.Users.findOne @userId, {fields: {username: 1}}\n\n\t\tapplication._id = RocketChat.models.OAuthApps.insert application\n\n\t\treturn application\n","Meteor.methods\n\tupdateOAuthApp: (applicationId, application) ->\n\t\tif not RocketChat.authz.hasPermission @userId, 'manage-oauth-apps'\n\t\t\tthrow new Meteor.Error 'not_authorized'\n\n\t\tif not _.isString(application.name)\n\t\t\tthrow new Meteor.Error 'invalid_name', '[methods] updateOAuthApp -> name must be string'\n\n\t\tif application.name.trim() is ''\n\t\t\tthrow new Meteor.Error 'invalid_name', '[methods] updateOAuthApp -> name can\\'t be empty'\n\n\t\tif not _.isString(application.redirectUri)\n\t\t\tthrow new Meteor.Error 'invalid_redirectUri', '[methods] updateOAuthApp -> redirectUri must be string'\n\n\t\tif application.redirectUri.trim() is ''\n\t\t\tthrow new Meteor.Error 'invalid_redirectUri', '[methods] updateOAuthApp -> redirectUri can\\'t be empty'\n\n\t\tif not _.isBoolean(application.active)\n\t\t\tthrow new Meteor.Error 'invalid_active', '[methods] updateOAuthApp -> active must be boolean'\n\n\t\tcurrentApplication = RocketChat.models.OAuthApps.findOne(applicationId)\n\t\tif not currentApplication?\n\t\t\tthrow new Meteor.Error 'invalid_application', '[methods] updateOAuthApp -> application not found'\n\n\t\tRocketChat.models.OAuthApps.update applicationId,\n\t\t\t$set:\n\t\t\t\tname: application.name\n\t\t\t\tactive: application.active\n\t\t\t\tredirectUri: application.redirectUri\n\t\t\t\t_updatedAt: new Date\n\t\t\t\t_updatedBy: RocketChat.models.Users.findOne @userId, {fields: {username: 1}}\n\n\t\treturn RocketChat.models.OAuthApps.findOne(applicationId)\n","Meteor.methods\n\tdeleteOAuthApp: (applicationId) ->\n\t\tif not RocketChat.authz.hasPermission @userId, 'manage-oauth-apps'\n\t\t\tthrow new Meteor.Error 'not_authorized'\n\n\t\tapplication = RocketChat.models.OAuthApps.findOne(applicationId)\n\n\t\tif not application?\n\t\t\tthrow new Meteor.Error 'invalid_application', '[methods] deleteOAuthApp -> application not found'\n\n\t\tRocketChat.models.OAuthApps.remove _id: applicationId\n\n\t\treturn true\n"]}