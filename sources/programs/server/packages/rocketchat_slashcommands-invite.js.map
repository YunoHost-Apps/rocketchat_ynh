{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat_slashcommands-invite/server.coffee"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;;;GAAA;AAAA;;AAAA;AAMc,kBAAC,OAAD,EAAU,MAAV,EAAkB,IAAlB;AACZ;AAAA,QAAG,YAAa,QAAb,IAAyB,MAAS,CAAC,IAAN,CAAW,MAAX,EAAmB,MAAnB,CAAhC;AACC,aADD;KAAA;AAAA,IAGA,WAAW,MAAM,CAAC,IAAP,EAHX;AAIA,QAAG,aAAY,EAAf;AACC,aADD;KAJA;AAAA,IAOA,WAAW,QAAQ,CAAC,OAAT,CAAiB,GAAjB,EAAsB,EAAtB,CAPX;AAAA,IASA,OAAO,MAAM,CAAC,KAAK,CAAC,OAAb,CAAqB;AAAA,MAAE,UAAU,QAAZ;KAArB,CATP;AAAA,IAUA,cAAc,MAAM,CAAC,KAAK,CAAC,OAAb,CAAqB,MAAM,CAAC,MAAP,EAArB,CAVd;AAYA,QAAO,YAAP;AACC,aAAO,CAAC,GAAR,CAAY,0BAAZ;AAAA,MACA,UAAU,CAAC,aAAa,CAAC,UAAzB,CAAoC,MAAM,CAAC,MAAP,EAApC,EAAqD,SAArD,EAAgE;AAAA,QAC/D,KAAK,MAAM,CAAC,EAAP,EAD0D;AAAA,QAE/D,KAAK,IAAI,CAAC,GAFqD;AAAA,QAG/D,IAAI,QAH2D;AAAA,QAI/D,KAAK,OAAO,CAAC,EAAR,CAAW,mBAAX,EAAgC;AAAA,UAAE,aAAa,SAAf;AAAA,UAA0B,SAAS,CAAE,QAAF,CAAnC;SAAhC,EAAmF,WAAW,CAAC,QAA/F,CAJ0D;OAAhE,CADA;AAOA,aARD;KAZA;AAuBA,QAAG,qFAAH;AACC,gBAAU,CAAC,aAAa,CAAC,UAAzB,CAAoC,MAAM,CAAC,MAAP,EAApC,EAAqD,SAArD,EAAgE;AAAA,QAC/D,KAAK,MAAM,CAAC,EAAP,EAD0D;AAAA,QAE/D,KAAK,IAAI,CAAC,GAFqD;AAAA,QAG/D,IAAI,QAH2D;AAAA,QAI/D,KAAK,OAAO,CAAC,EAAR,CAAW,6BAAX,EAA0C;AAAA,UAAE,aAAa,SAAf;AAAA,UAA0B,SAAS,CAAE,QAAF,CAAnC;SAA1C,EAA6F,WAAW,CAAC,QAAzG,CAJ0D;OAAhE;AAMA,aAPD;KAvBA;AAgCA;AACC,YAAM,CAAC,IAAP,CAAY,eAAZ,EACC;AAAA,aAAK,IAAI,CAAC,GAAV;AAAA,QACA,UAAU,IAAI,CAAC,QADf;OADD,EADD;KAAA;AAKC,MADK,UACL;AAAA,UAAG,CAAC,CAAC,KAAF,KAAW,6BAAd;AACC,kBAAU,CAAC,aAAa,CAAC,UAAzB,CAAoC,MAAM,CAAC,MAAP,EAApC,EAAqD,SAArD,EAAgE;AAAA,UAC/D,KAAK,MAAM,CAAC,EAAP,EAD0D;AAAA,UAE/D,KAAK,IAAI,CAAC,GAFqD;AAAA,UAG/D,IAAI,QAH2D;AAAA,UAI/D,KAAK,OAAO,CAAC,EAAR,CAAW,qCAAX,EAAkD,IAAlD,EAAwD,WAAW,CAAC,QAApE,CAJ0D;SAAhE,EADD;OAAA;AAQC,kBAAU,CAAC,aAAa,CAAC,UAAzB,CAAoC,MAAM,CAAC,MAAP,EAApC,EAAqD,SAArD,EAAgE;AAAA,UAC/D,KAAK,MAAM,CAAC,EAAP,EAD0D;AAAA,UAE/D,KAAK,IAAI,CAAC,GAFqD;AAAA,UAG/D,IAAI,QAH2D;AAAA,UAI/D,KAAK,CAAC,CAAC,KAJwD;SAAhE,EARD;OAAA;AAcA,aAnBD;KAjCY;EAAA,CAAb;;gBAAA;;IAND;;AAAA,UA4DU,CAAC,aAAa,CAAC,GAAzB,CAA6B,QAA7B,EAAuC,MAAvC,CA5DA","file":"/packages/rocketchat_slashcommands-invite.js","sourcesContent":["###\n# Invite is a named function that will replace /invite commands\n# @param {Object} message - The message object\n###\n\nclass Invite\n\tconstructor: (command, params, item) ->\n\t\tif command isnt 'invite' or not Match.test params, String\n\t\t\treturn\n\n\t\tusername = params.trim()\n\t\tif username is ''\n\t\t\treturn\n\n\t\tusername = username.replace('@', '')\n\n\t\tuser = Meteor.users.findOne({ username: username })\n\t\tcurrentUser = Meteor.users.findOne Meteor.userId()\n\n\t\tif not user?\n\t\t\tconsole.log 'notify user_doesnt_exist'\n\t\t\tRocketChat.Notifications.notifyUser Meteor.userId(), 'message', {\n\t\t\t\t_id: Random.id()\n\t\t\t\trid: item.rid\n\t\t\t\tts: new Date\n\t\t\t\tmsg: TAPi18n.__('User_doesnt_exist', { postProcess: 'sprintf', sprintf: [ username ] }, currentUser.language)\n\t\t\t}\n\t\t\treturn\n\n\t\t# cancel if the user is already in this room\n\t\tif RocketChat.models.Rooms.findOneByIdContainigUsername(item.rid, user.username)?\n\t\t\tRocketChat.Notifications.notifyUser Meteor.userId(), 'message', {\n\t\t\t\t_id: Random.id()\n\t\t\t\trid: item.rid\n\t\t\t\tts: new Date\n\t\t\t\tmsg: TAPi18n.__('Username_is_already_in_here', { postProcess: 'sprintf', sprintf: [ username ] }, currentUser.language)\n\t\t\t}\n\t\t\treturn\n\n\t\ttry\n\t\t\tMeteor.call 'addUserToRoom',\n\t\t\t\trid: item.rid\n\t\t\t\tusername: user.username\n\t\tcatch e\n\t\t\tif e.error is 'cant-invite-for-direct-room'\n\t\t\t\tRocketChat.Notifications.notifyUser Meteor.userId(), 'message', {\n\t\t\t\t\t_id: Random.id()\n\t\t\t\t\trid: item.rid\n\t\t\t\t\tts: new Date\n\t\t\t\t\tmsg: TAPi18n.__('Cannot_invite_users_to_direct_rooms', null, currentUser.language)\n\t\t\t\t}\n\t\t\telse\n\t\t\t\tRocketChat.Notifications.notifyUser Meteor.userId(), 'message', {\n\t\t\t\t\t_id: Random.id()\n\t\t\t\t\trid: item.rid\n\t\t\t\t\tts: new Date\n\t\t\t\t\tmsg: e.error\n\t\t\t\t}\n\t\t\treturn\n\nRocketChat.slashCommands.add 'invite', Invite\n"]}