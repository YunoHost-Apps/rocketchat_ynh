{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat_api/server/api.coffee","meteor://ðŸ’»app/packages/rocketchat_api/server/routes.coffee"],"names":[],"mappings":"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","file":"/packages/rocketchat_api.js","sourcesContent":["class API extends Restivus\n\tconstructor: ->\n\t\t@authMethods = []\n\t\tsuper\n\n\taddAuthMethod: (method) ->\n\t\t@authMethods.push method\n\n\tsuccess: (result={}) ->\n\t\tif _.isObject(result)\n\t\t\tresult.success = true\n\n\t\treturn {} =\n\t\t\tstatusCode: 200\n\t\t\tbody: result\n\n\tfailure: (result) ->\n\t\tif _.isObject(result)\n\t\t\tresult.success = false\n\t\telse\n\t\t\tresult =\n\t\t\t\tsuccess: false\n\t\t\t\terror: result\n\n\t\treturn {} =\n\t\t\tstatusCode: 400\n\t\t\tbody: result\n\n\tunauthorized: (msg) ->\n\t\treturn {} =\n\t\t\tstatusCode: 401\n\t\t\tbody:\n\t\t\t\tsuccess: false\n\t\t\t\terror: msg or 'unauthorized'\n\n\nRocketChat.API = {}\n\n\nRocketChat.API.v1 = new API\n\tversion: 'v1'\n\tuseDefaultAuth: true\n\tprettyJson: false\n\tenableCors: false\n\tauth:\n\t\ttoken: 'services.resume.loginTokens.hashedToken'\n\t\tuser: ->\n\t\t\tif @bodyParams?.payload?\n\t\t\t\t@bodyParams = JSON.parse @bodyParams.payload\n\n\t\t\tfor method in RocketChat.API.v1.authMethods\n\t\t\t\tresult = method.apply @, arguments\n\t\t\t\tif result not in [undefined, null, false]\n\t\t\t\t\treturn result\n\n\t\t\tif @request.headers['x-auth-token']\n\t\t\t\ttoken = Accounts._hashLoginToken @request.headers['x-auth-token']\n\n\t\t\treturn {} =\n\t\t\t\tuserId: @request.headers['x-user-id']\n\t\t\t\ttoken: token\n","RocketChat.API.v1.addRoute 'info', authRequired: false,\n\tget: -> RocketChat.Info\n\n\nRocketChat.API.v1.addRoute 'me', authRequired: true,\n\tget: ->\n\t\treturn _.pick @user, [\n\t\t\t'_id'\n\t\t\t'name'\n\t\t\t'emails'\n\t\t\t'status'\n\t\t\t'statusConnection'\n\t\t\t'username'\n\t\t\t'utcOffset'\n\t\t\t'active'\n\t\t\t'language'\n\t\t]\n\n\n# Send Channel Message\nRocketChat.API.v1.addRoute 'chat.messageExamples', authRequired: true,\n\tget: ->\n\t\treturn RocketChat.API.v1.success\n\t\t\tbody: [\n\t\t\t\ttoken: Random.id(24)\n\t\t\t\tchannel_id: Random.id()\n\t\t\t\tchannel_name: 'general'\n\t\t\t\ttimestamp: new Date\n\t\t\t\tuser_id: Random.id()\n\t\t\t\tuser_name: 'rocket.cat'\n\t\t\t\ttext: 'Sample text 1'\n\t\t\t\ttrigger_word: 'Sample'\n\t\t\t,\n\t\t\t\ttoken: Random.id(24)\n\t\t\t\tchannel_id: Random.id()\n\t\t\t\tchannel_name: 'general'\n\t\t\t\ttimestamp: new Date\n\t\t\t\tuser_id: Random.id()\n\t\t\t\tuser_name: 'rocket.cat'\n\t\t\t\ttext: 'Sample text 2'\n\t\t\t\ttrigger_word: 'Sample'\n\t\t\t,\n\t\t\t\ttoken: Random.id(24)\n\t\t\t\tchannel_id: Random.id()\n\t\t\t\tchannel_name: 'general'\n\t\t\t\ttimestamp: new Date\n\t\t\t\tuser_id: Random.id()\n\t\t\t\tuser_name: 'rocket.cat'\n\t\t\t\ttext: 'Sample text 3'\n\t\t\t\ttrigger_word: 'Sample'\n\t\t\t]\n\n\n# Send Channel Message\nRocketChat.API.v1.addRoute 'chat.postMessage', authRequired: true,\n\tpost: ->\n\t\ttry\n\t\t\tmessageReturn = processWebhookMessage @bodyParams, @user\n\n\t\t\tif not messageReturn?\n\t\t\t\treturn RocketChat.API.v1.failure 'unknown-error'\n\n\t\t\treturn RocketChat.API.v1.success\n\t\t\t\tts: Date.now()\n\t\t\t\tchannel: messageReturn.channel\n\t\t\t\tmessage: messageReturn.message\n\t\tcatch e\n\t\t\treturn RocketChat.API.v1.failure e.error\n\n# Set Channel Topic\nRocketChat.API.v1.addRoute 'channels.setTopic', authRequired: true,\n\tpost: ->\n\t\tif not @bodyParams.channel?\n\t\t\treturn RocketChat.API.v1.failure 'Body param \"channel\" is required'\n\n\t\tif not @bodyParams.topic?\n\t\t\treturn RocketChat.API.v1.failure 'Body param \"topic\" is required'\n\n\t\tunless RocketChat.authz.hasPermission(@userId, 'edit-room', @bodyParams.channel)\n\t\t\treturn RocketChat.API.v1.unauthorized()\n\n\t\tif not RocketChat.saveRoomTopic(@bodyParams.channel, @bodyParams.topic)\n\t\t\treturn RocketChat.API.v1.failure 'invalid_channel'\n\n\t\treturn RocketChat.API.v1.success\n\t\t\ttopic: @bodyParams.topic\n\n\n# Create Channel\nRocketChat.API.v1.addRoute 'channels.create', authRequired: true,\n\tpost: ->\n\t\tif not @bodyParams.name?\n\t\t\treturn RocketChat.API.v1.failure 'Body param \"name\" is required'\n\n\t\tif not RocketChat.authz.hasPermission(@userId, 'create-c')\n\t\t\treturn RocketChat.API.v1.unauthorized()\n\n\t\tid = undefined\n\t\ttry\n\t\t\tMeteor.runAsUser this.userId, =>\n\t\t\t\tid = Meteor.call 'createChannel', @bodyParams.name, []\n\t\tcatch e\n\t\t\treturn RocketChat.API.v1.failure e.name + ': ' + e.message\n\n\t\treturn RocketChat.API.v1.success\n\t\t\tchannel: RocketChat.models.Rooms.findOne({_id: id.rid})\n"]}