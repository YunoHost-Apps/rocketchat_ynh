{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat_authorization/lib/rocketchat.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/models/Permissions.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/models/Roles.coffee","meteor://ðŸ’»app/server/models/Base.js","meteor://ðŸ’»app/server/models/Users.js","meteor://ðŸ’»app/server/models/Subscriptions.js","meteor://ðŸ’»app/packages/rocketchat_authorization/server/functions/addUserRoles.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/functions/getRoles.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/functions/getUsersInRole.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/functions/hasPermission.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/functions/hasRole.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/functions/removeUserFromRoles.coffee","meteor://ðŸ’»app/server/publications/permissions.js","meteor://ðŸ’»app/packages/rocketchat_authorization/server/publications/roles.coffee","meteor://ðŸ’»app/server/publications/scopedRoles.js","meteor://ðŸ’»app/packages/rocketchat_authorization/server/publications/usersInRole.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/methods/addUserToRole.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/methods/deleteRole.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/methods/removeUserFromRole.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/methods/saveRole.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/methods/addPermissionToRole.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/methods/removeRoleFromPermission.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/startup.coffee"],"names":[],"mappings":"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","file":"/packages/rocketchat_authorization.js","sourcesContent":["RocketChat.authz = {}\n","RocketChat.models.Permissions = new class extends RocketChat.models._Base\n\tconstructor: ->\n\t\t@_initModel 'permissions'\n\n\t# FIND\n\tfindByRole: (role, options) ->\n\t\tquery =\n\t\t\troles: role\n\n\t\treturn @find query, options\n\n\tfindOneById: (_id) ->\n\t\treturn @findOne _id\n\n\tcreateOrUpdate: (name, roles) ->\n\t\t@upsert { _id: name }, { $set: { roles: roles } }\n\n\taddRole: (permission, role) ->\n\t\t@update({ _id: permission }, { $addToSet: { roles: role } })\n\n\tremoveRole: (permission, role) ->\n\t\t@update({ _id: permission }, { $pull: { roles: role } })\n\n\n","RocketChat.models.Roles = new class extends RocketChat.models._Base\n\tconstructor: ->\n\t\t@_initModel 'roles'\n\t\t@tryEnsureIndex { 'name': 1 }\n\t\t@tryEnsureIndex { 'scope': 1 }\n\n\tfindUsersInRole: (name, scope, options) ->\n\t\trole = @findOne name\n\t\troleScope = role?.scope or 'Users'\n\t\tRocketChat.models[roleScope]?.findUsersInRoles?(name, scope, options)\n\n\tisUserInRoles: (userId, roles, scope) ->\n\t\troles = [].concat roles\n\t\t_.some roles, (roleName) =>\n\t\t\trole = @findOne roleName\n\t\t\troleScope = role?.scope or 'Users'\n\t\t\treturn RocketChat.models[roleScope]?.isUserInRole?(userId, roleName, scope)\n\n\tcreateOrUpdate: (name, scope, description, protectedRole) ->\n\t\tscope ?= 'Users'\n\t\tupdateData = {}\n\t\tupdateData.name = name\n\t\tupdateData.scope = scope\n\t\tif description?\n\t\t\tupdateData.description = description\n\t\tif protectedRole?\n\t\t\tupdateData.protected = protectedRole\n\n\t\t@upsert { _id: name }, { $set: updateData }\n\n\taddUserRoles: (userId, roles, scope) ->\n\t\troles = [].concat roles\n\t\tfor roleName in roles\n\t\t\trole = @findOne roleName\n\t\t\troleScope = role?.scope or 'Users'\n\t\t\tRocketChat.models[roleScope]?.addRolesByUserId?(userId, roleName, scope)\n\n\tremoveUserRoles: (userId, roles, scope) ->\n\t\troles = [].concat roles\n\t\tfor roleName in roles\n\t\t\trole = @findOne roleName\n\t\t\troleScope = role?.scope or 'Users'\n\t\t\tRocketChat.models[roleScope]?.removeRolesByUserId?(userId, roleName, scope)\n","RocketChat.models._Base.prototype.roleBaseQuery = function(/*userId, scope*/) {\n\treturn {};\n};\n\nRocketChat.models._Base.prototype.findRolesByUserId = function(userId/*, options*/) {\n\tvar query = this.roleBaseQuery(userId);\n\treturn this.find(query, { fields: { roles: 1 } });\n};\n\nRocketChat.models._Base.prototype.isUserInRole = function(userId, roleName, scope) {\n\tvar query = this.roleBaseQuery(userId, scope);\n\tquery.roles = roleName;\n\treturn !_.isUndefined(this.findOne(query));\n};\n\nRocketChat.models._Base.prototype.addRolesByUserId = function(userId, roles, scope) {\n\troles = [].concat(roles);\n\tvar query = this.roleBaseQuery(userId, scope);\n\tvar update = {\n\t\t$addToSet: {\n\t\t\troles: { $each: roles }\n\t\t}\n\t};\n\treturn this.update(query, update);\n};\n\nRocketChat.models._Base.prototype.removeRolesByUserId = function(userId, roles, scope) {\n\troles = [].concat(roles);\n\tvar query = this.roleBaseQuery(userId, scope);\n\tvar update = {\n\t\t$pullAll: {\n\t\t\troles: roles\n\t\t}\n\t};\n\treturn this.update(query, update);\n};\n\nRocketChat.models._Base.prototype.findUsersInRoles = function() {\n\tthrow new Meteor.Error('overwrite-function', 'You must overwrite this function in the extended classes');\n};\n","RocketChat.models.Users.roleBaseQuery = function(userId) {\n\treturn { _id: userId };\n};\n\nRocketChat.models.Users.findUsersInRoles = function(roles, scope, options) {\n\troles = [].concat(roles);\n\n\tvar query = {\n\t\troles: { $in: roles }\n\t};\n\n\treturn this.find(query, options);\n};\n","RocketChat.models.Subscriptions.roleBaseQuery = function(userId, scope) {\n\tvar query = { 'u._id': userId };\n\tif (!_.isUndefined(scope)) {\n\t\tquery.rid = scope;\n\t}\n\treturn query;\n};\n\nRocketChat.models.Subscriptions.findUsersInRoles = function(roles, scope, options) {\n\troles = [].concat(roles);\n\n\tvar query = {\n\t\troles: { $in: roles }\n\t};\n\n\tif (scope) {\n\t\tquery.rid = scope;\n\t}\n\n\tvar subscriptions = this.find(query).fetch();\n\n\tvar users = _.compact(_.map(subscriptions, function(subscription) {\n\t\tif ('undefined' !== typeof subscription.u && 'undefined' !== typeof subscription.u._id) {\n\t\t\treturn subscription.u._id;\n\t\t}\n\t}));\n\n\treturn RocketChat.models.Users.find({ _id: { $in: users } }, options);\n};\n","RocketChat.authz.addUserRoles = (userId, roleNames, scope) ->\n\tif not userId or not roleNames\n\t\treturn false\n\n\tuser = RocketChat.models.Users.findOneById(userId)\n\tif not user\n\t\tthrow new Meteor.Error 'invalid-user'\n\n\troleNames = [].concat roleNames\n\n\texistingRoleNames = _.pluck(RocketChat.authz.getRoles(), '_id')\n\tinvalidRoleNames = _.difference(roleNames, existingRoleNames)\n\tunless _.isEmpty(invalidRoleNames)\n\t\tfor role in invalidRoleNames\n\t\t\tRocketChat.models.Roles.createOrUpdate role\n\n\tRocketChat.models.Roles.addUserRoles(userId, roleNames, scope)\n\n\treturn true\n","RocketChat.authz.getRoles = ->\n\treturn RocketChat.models.Roles.find().fetch()\n","RocketChat.authz.getUsersInRole = (roleName, scope, options) ->\n\treturn RocketChat.models.Roles.findUsersInRole(roleName, scope, options)\n","RocketChat.authz.hasPermission = (userId, permissionId, scope) ->\n\tpermission = RocketChat.models.Permissions.findOne permissionId\n\treturn RocketChat.models.Roles.isUserInRoles(userId, permission.roles, scope)\n","RocketChat.authz.hasRole = (userId, roleNames, scope) ->\n\troleNames = [].concat roleNames\n\treturn RocketChat.models.Roles.isUserInRoles(userId, roleNames, scope) # true if user is in ANY role\n","RocketChat.authz.removeUserFromRoles = (userId, roleNames, scope) ->\n\tif not userId or not roleNames\n\t\treturn false\n\n\tuser = RocketChat.models.Users.findOneById(userId)\n\tif not user?\n\t\tthrow new Meteor.Error 'error-invalid-user', 'Invalid user', { function: 'RocketChat.authz.removeUserRoles' }\n\n\troleNames = [].concat roleNames\n\n\texistingRoleNames = _.pluck(RocketChat.authz.getRoles(), 'name')\n\tinvalidRoleNames = _.difference(roleNames, existingRoleNames)\n\tunless _.isEmpty(invalidRoleNames)\n\t\tthrow new Meteor.Error 'invalid-role', 'Invalid role', { function: 'RocketChat.authz.removeUserRoles' }\n\n\tRocketChat.models.Roles.removeUserRoles(userId, roleNames, scope)\n\n\treturn true\n","Meteor.publish('permissions', function () {\n\treturn RocketChat.models.Permissions.find({});\n});\n","Meteor.publish 'roles', ->\n\tunless @userId\n\t\treturn @ready()\n\n\treturn RocketChat.models.Roles.find()\n\n","/**\n * Publish logged-in user's roles so client-side checks can work.\n */\nMeteor.publish('scopedRoles', function (scope) {\n\tif (!this.userId || _.isUndefined(RocketChat.models[scope]) || !_.isFunction(RocketChat.models[scope].findRolesByUserId)) {\n\t\tthis.ready();\n\t\treturn;\n\t}\n\n\treturn RocketChat.models[scope].findRolesByUserId(this.userId);\n});\n","Meteor.publish 'usersInRole', (roleName, scope, page = 1) ->\n\tunless @userId\n\t\treturn @ready()\n\n\tif not RocketChat.authz.hasPermission @userId, 'access-permissions'\n\t\tthrow new Meteor.Error \"not-authorized\"\n\n\titemsPerPage = 20\n\tpagination =\n\t\tsort:\n\t\t\tname: 1\n\t\tlimit: itemsPerPage\n\t\toffset: itemsPerPage * (page - 1)\n\n\treturn RocketChat.authz.getUsersInRole roleName, scope, pagination\n","Meteor.methods\n\t'authorization:addUserToRole': (roleName, username, scope) ->\n\t\tif not Meteor.userId() or not RocketChat.authz.hasPermission Meteor.userId(), 'access-permissions'\n\t\t\tthrow new Meteor.Error \"not-authorized\"\n\n\t\tif not roleName or not _.isString(roleName) or not username or not _.isString(username)\n\t\t\tthrow new Meteor.Error 'invalid-arguments'\n\n\t\tuser = RocketChat.models.Users.findOneByUsername username, { fields: { _id: 1 } }\n\n\t\tif not user?._id?\n\t\t\tthrow new Meteor.Error 'user-not-found', 'User_not_found'\n\n\t\tRocketChat.Notifications.notifyAll('roles-change', { type: 'added', _id: roleName, u: { _id: user._id, username: username }, scope: scope });\n\n\t\treturn RocketChat.models.Roles.addUserRoles user._id, roleName, scope\n","Meteor.methods\n\t'authorization:deleteRole': (roleName) ->\n\t\tif not Meteor.userId() or not RocketChat.authz.hasPermission Meteor.userId(), 'access-permissions'\n\t\t\tthrow new Meteor.Error \"not-authorized\"\n\n\t\trole = RocketChat.models.Roles.findOne roleName\n\t\tif not role?\n\t\t\tthrow new Meteor.Error 'invalid-role'\n\n\t\tif role.protected\n\t\t\tthrow new Meteor.Error 'protected-role', 'Cannot_delete_a_protected_role'\n\n\t\troleScope = role.scope or 'Users'\n\t\texistingUsers = RocketChat.models[roleScope]?.findUsersInRoles?(roleName)\n\n\t\tif existingUsers?.count() > 0\n\t\t\tthrow new Meteor.Error 'role-in-use', 'Cannot_delete_role_because_its_in_use'\n\n\t\treturn RocketChat.models.Roles.remove role.name\n","Meteor.methods\n\t'authorization:removeUserFromRole': (roleName, username, scope) ->\n\t\tif not Meteor.userId() or not RocketChat.authz.hasPermission Meteor.userId(), 'access-permissions'\n\t\t\tthrow new Meteor.Error \"not-authorized\"\n\n\t\tif not roleName or not _.isString(roleName) or not username or not _.isString(username)\n\t\t\tthrow new Meteor.Error 'invalid-arguments'\n\n\t\tuser = Meteor.users.findOne { username: username }, { fields: { _id: 1 } }\n\n\t\tif not user?._id?\n\t\t\tthrow new Meteor.Error 'user-not-found'\n\n\t\tRocketChat.Notifications.notifyAll('roles-change', { type: 'removed', _id: roleName, u: { _id: user._id, username: username }, scope: scope });\n\n\t\treturn RocketChat.models.Roles.removeUserRoles user._id, roleName, scope\n","Meteor.methods\n\t'authorization:saveRole': (roleData) ->\n\t\tif not Meteor.userId() or not RocketChat.authz.hasPermission Meteor.userId(), 'access-permissions'\n\t\t\tthrow new Meteor.Error \"error-not-authorized\", 'Not authorized', { method: 'authorization:saveRole' }\n\n\t\tif not roleData.name?\n\t\t\tthrow new Meteor.Error 'error-role-name-required', 'Role name is required', { method: 'authorization:saveRole' }\n\n\t\tif roleData.scope not in ['Users', 'Subscriptions']\n\t\t\troleData.scope = 'Users'\n\n\t\tRocketChat.Notifications.notifyAll('roles-change', { type: 'changed', _id: roleData.name });\n\n\t\treturn RocketChat.models.Roles.createOrUpdate roleData.name, roleData.scope, roleData.description\n","Meteor.methods\n\t'authorization:addPermissionToRole': (permission, role) ->\n\t\tif not Meteor.userId() or not RocketChat.authz.hasPermission Meteor.userId(), 'access-permissions'\n\t\t\tthrow new Meteor.Error \"not-authorized\"\n\n\t\tRocketChat.models.Permissions.addRole permission, role\n","Meteor.methods\n\t'authorization:removeRoleFromPermission': (permission, role) ->\n\t\tif not Meteor.userId() or not RocketChat.authz.hasPermission Meteor.userId(), 'access-permissions'\n\t\t\tthrow new Meteor.Error \"not-authorized\"\n\n\t\tRocketChat.models.Permissions.removeRole permission, role\n","Meteor.startup ->\n\n\t# Note:\n\t# 1.if we need to create a role that can only edit channel message, but not edit group message\n\t# then we can define edit-<type>-message instead of edit-message\n\t# 2. admin, moderator, and user roles should not be deleted as they are referened in the code.\n\tpermissions = [\n\t\t{ _id: 'access-permissions', roles : ['admin'] }\n\t\t{ _id: 'add-oauth-service', roles : ['admin'] }\n\t\t{ _id: 'add-user-to-room', roles : ['admin', 'owner', 'moderator'] }\n\t\t{ _id: 'archive-room', roles : ['admin', 'owner'] }\n\t\t{ _id: 'assign-admin-role', roles : ['admin'] }\n\t\t{ _id: 'ban-user', roles : ['admin', 'moderator', 'owner'] }\n\t\t{ _id: 'bulk-create-c', roles : ['admin'] }\n\t\t{ _id: 'bulk-register-user', roles : ['admin'] }\n\t\t{ _id: 'create-c', roles : ['admin', 'user'] }\n\t\t{ _id: 'create-p', roles : ['admin', 'user'] }\n\t\t{ _id: 'create-user', roles : ['admin'] }\n\t\t{ _id: 'delete-c', roles : ['admin'] }\n\t\t{ _id: 'delete-d', roles : ['admin'] }\n\t\t{ _id: 'delete-message', roles : ['admin', 'moderator', 'owner'] }\n\t\t{ _id: 'delete-p', roles : ['admin'] }\n\t\t{ _id: 'delete-user', roles : ['admin'] }\n\t\t{ _id: 'edit-message', roles : ['admin', 'moderator', 'owner'] }\n\t\t{ _id: 'edit-other-user-active-status', roles : ['admin'] }\n\t\t{ _id: 'edit-other-user-info', roles : ['admin'] }\n\t\t{ _id: 'edit-other-user-password', roles : ['admin'] }\n\t\t{ _id: 'edit-privileged-setting', roles : ['admin'] }\n\t\t{ _id: 'edit-room', roles : ['admin', 'moderator', 'owner'] }\n\t\t{ _id: 'manage-assets', roles : ['admin'] }\n\t\t{ _id: 'manage-integrations', roles : ['admin', 'bot'] }\n\t\t{ _id: 'manage-oauth-apps', roles : ['admin'] }\n\t\t{ _id: 'mute-user', roles : ['admin', 'moderator', 'owner'] }\n\t\t{ _id: 'remove-user', roles : ['admin', 'moderator', 'owner'] }\n\t\t{ _id: 'run-import', roles : ['admin'] }\n\t\t{ _id: 'run-migration', roles : ['admin'] }\n\t\t{ _id: 'set-moderator', roles : ['admin', 'owner'] }\n\t\t{ _id: 'set-owner', roles : ['admin', 'owner'] }\n\t\t{ _id: 'unarchive-room', roles : ['admin'] }\n\t\t{ _id: 'view-c-room', roles : ['admin', 'user', 'bot'] }\n\t\t{ _id: 'view-d-room', roles : ['admin', 'user'] }\n\t\t{ _id: 'view-full-other-user-info', roles : ['admin'] }\n\t\t{ _id: 'view-logs', roles : ['admin'] }\n\t\t{ _id: 'view-other-user-channels', roles : ['admin'] }\n\t\t{ _id: 'view-p-room', roles : ['admin', 'user'] }\n\t\t{ _id: 'view-privileged-setting', roles : ['admin'] }\n\t\t{ _id: 'view-room-administration', roles : ['admin'] }\n\t\t{ _id: 'view-statistics', roles : ['admin'] }\n\t\t{ _id: 'view-user-administration', roles : ['admin'] }\n\t]\n\n\tfor permission in permissions\n\t\tunless RocketChat.models.Permissions.findOneById( permission._id)?\n\t\t\tRocketChat.models.Permissions.upsert( permission._id, {$set: permission })\n\n\tdefaultRoles = [\n\t\t{ name: 'admin', scope: 'Users', description: 'Admin' }\n\t\t{ name: 'moderator', scope: 'Subscriptions', description: 'Moderator' }\n\t\t{ name: 'owner', scope: 'Subscriptions', description: 'Owner' }\n\t\t{ name: 'user', scope: 'Users', description: '' }\n\t\t{ name: 'bot', scope: 'Users', description: '' }\n\t]\n\n\tfor role in defaultRoles\n\t\tRocketChat.models.Roles.upsert { _id: role.name }, { $setOnInsert: { scope: role.scope, description: role.description || '', protected: true } }\n"]}