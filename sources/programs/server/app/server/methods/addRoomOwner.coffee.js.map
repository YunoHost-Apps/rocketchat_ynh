{"version":3,"sources":["meteor://ðŸ’»app/server/methods/addRoomOwner.coffee"],"names":[],"mappings":";;;;;;;;;AAAA,MAAM,CAAC,OAAP,CACC;AAAA,gBAAc,SAAC,GAAD,EAAM,MAAN;AACb;AAAA,eAAa,CAAC,MAAP,EAAP;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,oBAAb,EAAmC,cAAnC,EAAmD;AAAA,QAAE,QAAQ,cAAV;OAAnD,CAAV,CADD;KAAA;AAAA,IAGA,MAAM,GAAN,EAAW,MAAX,CAHA;AAAA,IAIA,MAAM,MAAN,EAAc,MAAd,CAJA;AAMA,mBAAiB,CAAC,KAAK,CAAC,aAAjB,CAA+B,MAAM,CAAC,MAAP,EAA/B,EAAgD,WAAhD,EAA6D,GAA7D,CAAP;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,mBAAb,EAAkC,aAAlC,EAAiD;AAAA,QAAE,QAAQ,cAAV;OAAjD,CAAV,CADD;KANA;AAAA,IASA,eAAe,UAAU,CAAC,MAAM,CAAC,aAAa,CAAC,wBAAhC,CAAyD,GAAzD,EAA8D,MAA9D,CATf;AAUA,QAAO,oBAAP;AACC,YAAU,UAAM,CAAC,KAAP,CAAa,oBAAb,EAAmC,cAAnC,EAAmD;AAAA,QAAE,QAAQ,cAAV;OAAnD,CAAV,CADD;KAVA;AAAA,IAaA,UAAU,CAAC,MAAM,CAAC,aAAa,CAAC,WAAhC,CAA4C,YAAY,CAAC,GAAzD,EAA8D,OAA9D,CAbA;AAAA,IAeA,OAAO,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,WAAxB,CAAoC,MAApC,CAfP;AAAA,IAgBA,WAAW,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,WAAxB,CAAoC,MAAM,CAAC,MAAP,EAApC,CAhBX;AAAA,IAiBA,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,4CAA3B,CAAwE,GAAxE,EAA6E,IAA7E,EACC;AAAA,SACC;AAAA,aAAK,QAAQ,CAAC,GAAd;AAAA,QACA,UAAU,QAAQ,CAAC,QADnB;OADD;AAAA,MAGA,MAAM,OAHN;KADD,CAjBA;AAAA,IAuBA,UAAU,CAAC,aAAa,CAAC,SAAzB,CAAmC,cAAnC,EAAmD;AAAA,MAAE,MAAM,OAAR;AAAA,MAAiB,KAAK,OAAtB;AAAA,MAA+B,GAAG;AAAA,QAAE,KAAK,IAAI,CAAC,GAAZ;AAAA,QAAiB,UAAU,IAAI,CAAC,QAAhC;OAAlC;AAAA,MAA8E,OAAO,GAArF;KAAnD,CAvBA;AAyBA,WAAO,IAAP,CA1Ba;EAAA,CAAd;CADD","file":"/server/methods/addRoomOwner.coffee.js","sourcesContent":["Meteor.methods\n\taddRoomOwner: (rid, userId) ->\n\t\tunless Meteor.userId()\n\t\t\tthrow new Meteor.Error 'error-invalid-user', 'Invalid user', { method: 'addRoomOwner' }\n\n\t\tcheck rid, String\n\t\tcheck userId, String\n\n\t\tunless RocketChat.authz.hasPermission Meteor.userId(), 'set-owner', rid\n\t\t\tthrow new Meteor.Error 'error-not-allowed', 'Not allowed', { method: 'addRoomOwner' }\n\n\t\tsubscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId rid, userId\n\t\tunless subscription?\n\t\t\tthrow new Meteor.Error 'error-invalid-room', 'Invalid room', { method: 'addRoomOwner' }\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'owner')\n\n\t\tuser = RocketChat.models.Users.findOneById userId\n\t\tfromUser = RocketChat.models.Users.findOneById Meteor.userId()\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser rid, user,\n\t\t\tu:\n\t\t\t\t_id: fromUser._id\n\t\t\t\tusername: fromUser.username\n\t\t\trole: 'owner'\n\n\t\tRocketChat.Notifications.notifyAll('roles-change', { type: 'added', _id: 'owner', u: { _id: user._id, username: user.username }, scope: rid });\n\n\t\treturn true\n"]}