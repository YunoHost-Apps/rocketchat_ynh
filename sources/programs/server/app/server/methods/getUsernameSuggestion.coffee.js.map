{"version":3,"sources":["meteor://ğŸ’»app/server/methods/getUsernameSuggestion.coffee"],"names":[],"mappings":"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","file":"/server/methods/getUsernameSuggestion.coffee.js","sourcesContent":["slug = (text) ->\n\ttext = slugify text, '.'\n\treturn text.replace(/[^0-9a-z-_.]/g, '')\n\nusernameIsAvaliable = (username) ->\n\tif username.length < 1\n\t\treturn false\n\n\tif username is 'all'\n\t\treturn false\n\n\treturn not RocketChat.models.Users.findOneByUsername({$regex : new RegExp(\"^\" + username + \"$\", \"i\") })\n\n@generateSuggestion = (user) ->\n\tusernames = []\n\tusername = undefined\n\n\tif Meteor.settings.public.sandstorm\n\t\tusernames.push user.services.sandstorm.preferredHandle\n\n\tif RocketChat.settings.get 'UTF8_Names_Slugify'\n\t\tusernames.push slug user.name\n\telse\n\t\tusernames.push user.name\n\n\tnameParts = user?.name?.split(' ')\n\tif nameParts.length > 1\n\t\tfirst = nameParts[0]\n\t\tlast = nameParts[nameParts.length - 1]\n\n\t\tif RocketChat.settings.get 'UTF8_Names_Slugify'\n\t\t\tusernames.push slug first[0] + last\n\t\t\tusernames.push slug first + last[0]\n\t\telse\n\t\t\tusernames.push first[0] + last\n\t\t\tusernames.push first + last[0]\n\n\tif user.profile?.name?\n\t\tif RocketChat.settings.get 'UTF8_Names_Slugify'\n\t\t\tusernames.push slug user.profile.name\n\t\telse\n\t\t\tusernames.push user.profile.name\n\n\tif user.services?\n\t\tfor serviceName, service of user.services\n\t\t\tif service.name?\n\t\t\t\tif RocketChat.settings.get 'UTF8_Names_Slugify'\n\t\t\t\t\tusernames.push slug service.name\n\t\t\t\telse\n\t\t\t\t\tusernames.push service.name\n\t\t\telse if service.username?\n\t\t\t\tif RocketChat.settings.get 'UTF8_Names_Slugify'\n\t\t\t\t\tusernames.push slug service.username\n\t\t\t\telse\n\t\t\t\t\tusernames.push service.username\n\n\tif user.emails?.length > 0\n\t\tfor email in user.emails when email.address? and email.verified is true\n\t\t\tusernames.push slug email.address.replace(/@.+$/, '')\n\n\t\tfor email in user.emails when email.address? and email.verified is true\n\t\t\tusernames.push slug email.address.replace(/(.+)@(\\w+).+/, '$1.$2')\n\n\tfor item in usernames\n\t\tif usernameIsAvaliable item\n\t\t\tusername = item\n\t\t\tbreak\n\n\tif usernames[0]? and usernames[0].length > 0\n\t\tindex = 0\n\t\twhile not username?\n\t\t\tindex++\n\t\t\tif usernameIsAvaliable usernames[0] + '-' + index\n\t\t\t\tusername = usernames[0] + '-' + index\n\n\tif usernameIsAvaliable username\n\t\treturn username\n\n\treturn undefined\nRocketChat.generateUsernameSuggestion = generateSuggestion\n\nMeteor.methods\n\tgetUsernameSuggestion: ->\n\t\tunless Meteor.userId()\n\t\t\tthrow new Meteor.Error(403, \"[methods] getUsernameSuggestion -> Invalid user\")\n\n\t\tuser = Meteor.user()\n\t\treturn generateSuggestion(user)\n"]}